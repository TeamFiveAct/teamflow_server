<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>워크스페이스 소켓 예제</title>
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .users-list {
            border: 1px solid #ddd;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        
        .user-item img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .connect-btn { background-color: #28a745; color: white; }
        .disconnect-btn { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>워크스페이스 소켓 예제</h1>
        
        <div>
            <input type="number" id="workspace-id" placeholder="워크스페이스 ID 입력" />
            <button class="connect-btn" onclick="connect()">연결</button>
            <button class="disconnect-btn" onclick="disconnect()">연결 해제</button>
        </div>

        <div class="status" id="status"></div>
        
        <div class="users-list" id="users-list">
            <h2>접속자 목록</h2>
            <!-- 사용자 목록이 여기에 동적으로 추가됨 -->
        </div>
    </div>

    <!-- Socket.IO 클라이언트 라이브러리 -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- 예제 코드 -->
    <script src="/socket-example.js"></script>
    <script>
        let currentSocket = null;
        let currentLeaveWorkspace = null;

        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
        }

        async function connect() {
            try {
                const workspaceId = document.getElementById('workspace-id').value;
                if (!workspaceId) {
                    throw new Error('워크스페이스 ID를 입력해주세요.');
                }

                // 이미 연결된 소켓이 있다면 먼저 연결 해제
                if (currentSocket) {
                    disconnect();
                }

                const { socket, leaveWorkspace } = await connectToWorkspace(workspaceId);
                currentSocket = socket;
                currentLeaveWorkspace = leaveWorkspace;
                
                showStatus(`워크스페이스 ${workspaceId}에 연결되었습니다.`);
            } catch (error) {
                showStatus(error.message, true);
            }
        }

        function disconnect() {
            if (currentLeaveWorkspace) {
                currentLeaveWorkspace();
            }
            if (currentSocket) {
                currentSocket.disconnect();
                currentSocket = null;
                currentLeaveWorkspace = null;
                document.getElementById('users-list').innerHTML = '<h2>접속자 목록</h2>';
                showStatus('연결이 해제되었습니다.');
            }
        }

        // 페이지 종료 시 연결 해제
        window.addEventListener('beforeunload', disconnect);
    </script>
</body>
